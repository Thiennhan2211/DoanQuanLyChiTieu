{% extends "base.html" %}
{% block content %}
<div class="row justify-content-center mt-4">
  <div class="col-md-6">
    <div class="card shadow">
      <div class="card-body text-center">
        <img src="{{ url_for('static', filename='images/default-avatar.png') if not user.avatar else url_for('static', filename=user.avatar) }}" alt="avatar" class="rounded-circle mb-3" width="100" height="100" style="object-fit:cover;">
        <h3>{{ user.username }}</h3>
        <p class="text-muted">{{ user.email }}</p>
        <hr>
        <h5>Bạn bè</h5>
        <ul class="list-group list-group-flush">
          {% for f in friends %}
            <li class="list-group-item">{{ f.username }} ({{ f.email }})</li>
          {% else %}
            <li class="list-group-item text-muted">Chưa có bạn bè</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}
<script>
document.addEventListener("DOMContentLoaded", function() {
  const notifBtn = document.getElementById("notifBtn");
  const notifBox = document.getElementById("notifBox");
  const notifList = document.getElementById("notifList");

  notifBtn.addEventListener("click", () => {
    notifBox.style.display = notifBox.style.display === "none" ? "block" : "none";
  });

  function loadNotifications() {
    fetch("/auth/notifications_data")
      .then(response => response.json())
      .then(data => {
        notifList.innerHTML = "";
        if (data.length === 0) {
          notifList.innerHTML = "<p class='text-center text-muted mb-0'>Không có thông báo nào</p>";
        } else {
          data.forEach(n => {
            notifList.innerHTML += `
              <div class="border-bottom py-2 px-2">
                <a href="${n.link}" class="text-decoration-none ${n.is_read ? 'text-muted' : 'fw-bold'}">
                  ${n.message}
                </a><br>
                <small class="text-muted">${n.created_at}</small>
              </div>`;
          });
        }
      });
  }

  loadNotifications();
  setInterval(loadNotifications, 5000); // reload mỗi 5 giây
});
</script>
