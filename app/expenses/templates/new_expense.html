{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <div class="card shadow-sm border-0 rounded-4">
    <div class="card-body">
      <h3 class="fw-bold text-success mb-4">ğŸ’¸ ThÃªm chi tiÃªu má»›i</h3>

      <form method="POST">
        <div class="mb-3">
          <label class="form-label">TÃªn chi tiÃªu</label>
          <input type="text" name="title" class="form-control" placeholder="VÃ­ dá»¥: Bá»¯a Äƒn tá»‘i" required>
        </div>
        <label>Loáº¡i chi tiÃªu</label>
<select name="category_id" class="form-control">
    <option value="">-- Chá»n loáº¡i --</option>
    {% for c in categories %}
    <option value="{{ c.id }}">{{ c.icon }} {{ c.name }}</option>
    {% endfor %}
</select>
<br>
        <div class="mb-3">
          <label class="form-label">Loáº¡i tiá»n tá»‡</label>
            <select name="currency" id="currency" class="form-select">
              <option value="VND" selected>ğŸ‡»ğŸ‡³ VND (â‚«)</option>
              <option value="USD">ğŸ‡ºğŸ‡¸ USD ($)</option>
              <option value="EUR">ğŸ‡ªğŸ‡º EUR (â‚¬)</option>
              <option value="JPY">ğŸ‡¯ğŸ‡µ JPY (Â¥)</option>
            </select>
          </div>

        <div class="mb-3">
          <label class="form-label">Tá»•ng sá»‘ tiá»n</label>
          <input type="number" step="0.01" name="amount" id="amount" class="form-control" placeholder="Nháº­p sá»‘ tiá»n..." required>
        </div>

        <div class="mb-3">
          <label class="form-label">Ai Ä‘Ã£ tráº£ tiá»n?</label>
          <select name="payer_id" class="form-select" required>
            {% for member in members %}
              <option value="{{ member.id }}" {% if member.id == current_user.id %}selected{% endif %}>
                {{ member.username }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">Kiá»ƒu chia</label>
          <select name="split_type" id="split_type" class="form-select">
            <option value="equal">Chia Ä‘á»u</option>
            <option value="percent">Chia theo %</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">DÃ nh cho ai?</label>
          {% for member in members %}
            <div class="input-group mb-2 align-items-center">
              <div class="input-group-text">
                <input class="form-check-input mt-0" type="checkbox" name="member_ids" value="{{ member.id }}" checked>
              </div>
              <span class="form-control">{{ member.username }}</span>
              <input type="number" name="percent_{{ member.id }}" class="form-control percent-input" style="max-width:100px; display:none;" placeholder="%">
            </div>
          {% endfor %}
        </div>

        <div class="mb-3">
          <label class="form-label">Ghi chÃº</label>
          <textarea name="note" class="form-control" rows="2"></textarea>
        </div>

        <div class="text-end">
          <button type="submit" class="btn btn-success px-4">ğŸ’¾ LÆ°u</button>
          <a href="{{ url_for('expenses.expense_list', group_id=group.id) }}" class="btn btn-outline-secondary">Há»§y</a>
        </div>
      </form>
    </div>
  </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const notifBtn = document.getElementById("notifBtn");
  const notifBox = document.getElementById("notifBox");
  const notifList = document.getElementById("notifList");

  notifBtn.addEventListener("click", () => {
    notifBox.style.display = notifBox.style.display === "none" ? "block" : "none";
  });

  function loadNotifications() {
    fetch("/auth/notifications_data")
      .then(response => response.json())
      .then(data => {
        notifList.innerHTML = "";
        if (data.length === 0) {
          notifList.innerHTML = "<p class='text-center text-muted mb-0'>KhÃ´ng cÃ³ thÃ´ng bÃ¡o nÃ o</p>";
        } else {
          data.forEach(n => {
            notifList.innerHTML += `
              <div class="border-bottom py-2 px-2">
                <a href="${n.link}" class="text-decoration-none ${n.is_read ? 'text-muted' : 'fw-bold'}">
                  ${n.message}
                </a><br>
                <small class="text-muted">${n.created_at}</small>
              </div>`;
          });
        }
      });
  }

  loadNotifications();
  setInterval(loadNotifications, 5000); // reload má»—i 5 giÃ¢y
});
</script>

<script>
document.getElementById('split_type').addEventListener('change', function() {
  const showPercent = this.value === 'percent';
  document.querySelectorAll('.percent-input').forEach(el => {
    el.style.display = showPercent ? 'block' : 'none';
  });
});
</script>
{% endblock %}