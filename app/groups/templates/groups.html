{% extends "base.html" %}
{% block content %}
<div class="container mt-5">
  <div class="card shadow-sm p-4">
    <h2 class="text-center text-success mb-4"> Danh s谩ch nh贸m</h2>
    {% if groups %}
    <div class="table-responsive">
      <table class="table align-middle text-center">
        <thead class="table-success">
          <tr>
            <th scope="col">T锚n nh贸m</th>
            <th scope="col">Ngy t岷o</th>
            <th scope="col">Thao t谩c</th>
          </tr>
        </thead>
        <tbody>
          {% for group in groups %}
          <tr>
            <td class="fw-semibold">{{ group.name }}</td>
            <td>{{ group.created_at.strftime('%d/%m/%Y') if group.created_at else '' }}</td>
            <td>
              <a href="{{ url_for('expenses.expense_list', group_id=group.id) }}" class="btn btn-outline-success btn-sm">
                Xem chi ti岷t
              </a>
              <form action="{{ url_for('groups.delete_group', group_id=group.id) }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-outline-danger btn-sm" onclick="return confirm('B岷n c贸 ch岷c mu峄n x贸a nh贸m ny kh么ng?');">
                  X贸a
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      <script>
document.addEventListener("DOMContentLoaded", function() {
  const notifBtn = document.getElementById("notifBtn");
  const notifBox = document.getElementById("notifBox");
  const notifList = document.getElementById("notifList");

  notifBtn.addEventListener("click", () => {
    notifBox.style.display = notifBox.style.display === "none" ? "block" : "none";
  });

  function loadNotifications() {
    fetch("/auth/notifications_data")
      .then(response => response.json())
      .then(data => {
        notifList.innerHTML = "";
        if (data.length === 0) {
          notifList.innerHTML = "<p class='text-center text-muted mb-0'>Kh么ng c贸 th么ng b谩o no</p>";
        } else {
          data.forEach(n => {
            notifList.innerHTML += `
              <div class="border-bottom py-2 px-2">
                <a href="${n.link}" class="text-decoration-none ${n.is_read ? 'text-muted' : 'fw-bold'}">
                  ${n.message}
                </a><br>
                <small class="text-muted">${n.created_at}</small>
              </div>`;
          });
        }
      });
  }

  loadNotifications();
  setInterval(loadNotifications, 5000); // reload m峄i 5 gi芒y
});
</script>
      </table>
    </div>
    {% else %}
    <p class="text-center text-muted mt-3">Ch瓢a c贸 nh贸m no. H茫y t岷o nh贸m m峄i!</p>
    {% endif %}

    <div class="text-center mt-4">
      <a href="{{ url_for('groups.group_new') }}" class="btn btn-success px-4">+ T岷o nh贸m m峄i</a>
    </div>

  </div>
</div>
{% endblock %}
